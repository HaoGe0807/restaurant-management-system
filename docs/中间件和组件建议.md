# 中间件和组件建议清单

## 当前已使用的中间件

✅ **数据库**：MySQL  
✅ **ORM**：MyBatis-Plus  
✅ **本地缓存**：Caffeine  
✅ **分布式缓存**：Redis  
✅ **领域事件**：事务性发件箱模式（自实现）

---

## 建议添加的中间件和组件

### 1. 消息队列（MQ）

#### 1.1 RabbitMQ
**用途**：
- 异步消息处理
- 领域事件发布（替代当前的事务性发件箱）
- 削峰填谷
- 解耦服务

**适用场景**：
- 订单创建后异步通知库存、物流
- 商品创建后异步创建库存
- 订单支付后异步发送通知

**优势**：
- 成熟稳定
- 支持多种消息模式（点对点、发布订阅）
- 支持消息确认和重试

#### 1.2 Apache Kafka
**用途**：
- 高吞吐量的消息流处理
- 事件溯源
- 日志收集

**适用场景**：
- 大量订单数据的实时处理
- 用户行为日志收集
- 实时数据流处理

**优势**：
- 高吞吐量
- 支持分区和副本
- 适合大数据场景

**推荐**：RabbitMQ（更适合业务场景）

---

### 2. 搜索引擎

#### 2.1 Elasticsearch
**用途**：
- 商品搜索
- 订单搜索
- 日志分析

**适用场景**：
- 商品名称、描述全文搜索
- 订单号、用户ID搜索
- 系统日志查询和分析

**功能**：
- 全文检索
- 聚合分析
- 实时搜索

---

### 3. 配置中心

#### 3.1 Nacos / Apollo
**用途**：
- 集中管理配置
- 动态配置更新
- 服务发现

**适用场景**：
- 数据库连接配置
- 缓存过期时间配置
- 业务规则配置（如库存阈值）

**优势**：
- 配置热更新
- 多环境配置管理
- 配置版本管理

**推荐**：Nacos（Spring Cloud Alibaba 生态）

---

### 4. 服务注册与发现

#### 4.1 Nacos / Eureka / Consul
**用途**：
- 服务注册
- 服务发现
- 负载均衡

**适用场景**：
- 微服务架构
- 服务间调用
- 动态扩缩容

**推荐**：Nacos（功能全面，包含配置中心）

---

### 5. 分布式链路追踪

#### 5.1 SkyWalking / Zipkin / Jaeger
**用途**：
- 请求链路追踪
- 性能监控
- 问题定位

**适用场景**：
- 跨服务调用追踪
- 性能瓶颈分析
- 错误排查

**功能**：
- 分布式追踪
- 性能分析
- 拓扑图展示

**推荐**：SkyWalking（对 Java 支持好，无侵入）

---

### 6. 监控和告警

#### 6.1 Prometheus + Grafana
**用途**：
- 指标收集
- 性能监控
- 可视化展示

**适用场景**：
- JVM 监控
- 接口 QPS、响应时间
- 缓存命中率
- 数据库连接池监控

**功能**：
- 指标采集
- 告警规则
- 可视化大屏

#### 6.2 Micrometer
**用途**：
- 应用指标收集
- 与 Prometheus 集成

**适用场景**：
- 业务指标统计
- 自定义指标

---

### 7. 日志管理

#### 7.1 ELK Stack（Elasticsearch + Logstash + Kibana）
**用途**：
- 日志收集
- 日志分析
- 日志可视化

**适用场景**：
- 应用日志查询
- 错误日志分析
- 日志聚合

#### 7.2 Logback / Log4j2
**用途**：
- 日志框架
- 日志输出

**推荐**：Logback（Spring Boot 默认）

---

### 8. 限流和熔断

#### 8.1 Sentinel / Hystrix
**用途**：
- 流量控制
- 熔断降级
- 系统保护

**适用场景**：
- 接口限流（防止刷单）
- 服务熔断（防止雪崩）
- 热点参数限流

**推荐**：Sentinel（阿里开源，功能强大）

---

### 9. 分布式锁

#### 9.1 Redisson
**用途**：
- 基于 Redis 的分布式锁
- 分布式对象

**适用场景**：
- 库存扣减（防止超卖）
- 订单创建（防止重复下单）
- 定时任务（防止重复执行）

**功能**：
- 可重入锁
- 读写锁
- 信号量

---

### 10. 任务调度

#### 10.1 XXL-JOB / Elastic-Job
**用途**：
- 分布式任务调度
- 定时任务管理

**适用场景**：
- 定时同步数据
- 定时清理过期数据
- 定时生成报表

**推荐**：XXL-JOB（简单易用）

---

### 11. 对象存储

#### 11.1 MinIO / OSS / COS
**用途**：
- 文件存储
- 图片存储

**适用场景**：
- 商品图片
- 用户头像
- 订单附件

**推荐**：MinIO（开源，可自建）

---

### 12. API 网关

#### 12.1 Spring Cloud Gateway / Zuul
**用途**：
- 统一入口
- 路由转发
- 鉴权认证

**适用场景**：
- 统一 API 入口
- 跨域处理
- 限流熔断

---

### 13. 数据库中间件

#### 13.1 ShardingSphere
**用途**：
- 分库分表
- 读写分离
- 数据脱敏

**适用场景**：
- 大数据量场景
- 高并发场景

---

### 14. 数据同步

#### 14.1 Canal / Debezium
**用途**：
- MySQL Binlog 解析
- 数据同步
- 数据变更监听

**适用场景**：
- 缓存更新（监听数据库变更）
- 数据同步到 ES
- 数据变更通知

**推荐**：Canal（阿里开源）

---

### 15. 测试相关

#### 15.1 JMeter / Gatling
**用途**：
- 压力测试
- 性能测试

**适用场景**：
- 接口压测
- 性能优化验证

---

## 优先级推荐

### 高优先级（核心功能）
1. **消息队列（RabbitMQ）** - 异步处理、解耦
2. **分布式锁（Redisson）** - 防止并发问题
3. **限流熔断（Sentinel）** - 系统保护
4. **监控（Prometheus + Grafana）** - 可观测性

### 中优先级（增强功能）
5. **搜索引擎（Elasticsearch）** - 搜索功能
6. **配置中心（Nacos）** - 配置管理
7. **链路追踪（SkyWalking）** - 问题排查
8. **任务调度（XXL-JOB）** - 定时任务

### 低优先级（可选功能）
9. **对象存储（MinIO）** - 文件存储
10. **API 网关（Spring Cloud Gateway）** - 统一入口
11. **数据同步（Canal）** - 数据变更监听

---

## 技术栈组合建议

### 方案1：轻量级（适合练手）
- 消息队列：RabbitMQ
- 分布式锁：Redisson
- 限流：Sentinel
- 监控：Prometheus + Grafana
- 日志：Logback + ELK

### 方案2：完整版（企业级）
- 消息队列：RabbitMQ / Kafka
- 配置中心：Nacos
- 服务注册：Nacos
- 限流熔断：Sentinel
- 链路追踪：SkyWalking
- 监控：Prometheus + Grafana
- 搜索引擎：Elasticsearch
- 任务调度：XXL-JOB
- 分布式锁：Redisson

---

## 实施建议

1. **分阶段实施**：先添加核心中间件（MQ、分布式锁），再逐步添加其他
2. **结合实际场景**：根据业务需求选择，不要为了用而用
3. **文档完善**：每个中间件都要有使用文档和示例
4. **监控先行**：先搭建监控，再添加其他中间件，方便观察效果

---

## 学习价值

这些中间件覆盖了：
- ✅ **消息通信**：MQ
- ✅ **数据存储**：MySQL、Redis、ES
- ✅ **服务治理**：注册中心、配置中心、网关
- ✅ **可观测性**：监控、日志、链路追踪
- ✅ **系统保护**：限流、熔断、分布式锁
- ✅ **任务调度**：定时任务
- ✅ **文件存储**：对象存储

掌握这些中间件，基本可以应对大部分企业级项目需求。

